# Lab 1

## Lab 01-01

### 1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures?

**lab01-01.dll**

![result when submitting the dll to Virustotal](virusTotalDLL.png)

<br/><br/>

**lab01-01.exe**

![result when submitting the exe to Virustotal](virusTotalExe.png)

<br/><br/>

### 2. When were these files compiled?

Using PE-bear, I was able to get the time the file is compiled.

<br/><br/>

**lab01-01.dll**

![When is the DLL compiled](compiledTime_dll.png)

<br/><br/>

**lab01-01.exe**

![When is the EXE compiled](compiledTime_exe.png)

<br/><br/>

### 3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?

Using PEiD, the files don't seem to be packed

<br/><br/>

**lab01-01.dll**

![Using PEiD to show dll not packed](PEiD_dll.png)

**lab01-01.exe**

![Using PEiD to show exe not packed](PEiD_exe.png)

<br/><br/>

### 4. Do any imports hint at what this malware does? If so, which imports are they?

 - lab01-01.exe
	 - KERNEL32.dll
		 - ![Imported functions from KERNEL32.dll in exe file](exe_kernel32_import.png)
		 - This DLL file is quite common in many binary files. In this case, it mainly imports functions to create new files and find specific files in the system.
	 - MSVCRT.dll
		 - ![Imported functions from MSVCRT.dll in exe file](exe_msvcrt_import.png)
		 - MSVCRT.dll is a standard library for Visual C++, which provides programs with most of the standard C library functions.
- lab01-01.dll
	- KERNEL32.dll
		- ![Imported functions from KERNEL32.dll in dll file](dll_kernel32_import.png)
		- Quite similar to the exe file imports, but this time, Mutex is involved in the imports.
		- A mutex object protects a shared resource from multiple access by threads and processes. Malware author uses this to make sure they do not reinfect an already infected system. 
	- WS2_32.dll
		- ![Providing networking functionality to binary with WS2_32.dll](dll_WS2_32_usage.png)
		- This linked library is used to handle network connections

<br/><br/>

### 5. Are there any other files or host-based indicators that you could look for on infected systems?  

A file is found when running **strings** with the DLL file named  Kernel132.dll. This "Kernel132.dll" file might be the file that will override the real KERNEL32 by disguising it. Besides that, the lab01-01.dll DLL file is also not a common system DLL file. We could use these files as an IOC to identify infected systems.

![file IOC](file_IOC.png)

<br/><br/>

### 6. What network-based indicators could be used to find this malware on infected machines?

When using the **strings** command to get the strings in the lab01-01.dll file, it's found that the file will be communicating with a server host at "`127.26.152.13` ". This could be our IOC in detecting the infection through network traffic sniffing and monitoring.

![Network IOC](network_IOC.png)

<br/><br/>

### 7. What would you guess is the purpose of these files?

These files most probably will create a backdoor in the victim's machine. Then, once the malware is executed, the malware will connect to a C2 server where further instruction is processed to the malware installed. For the malware to successfully exploit the system, it needs to replace the KERNEL32.dll with another malicious file. The WS2_32 library makes the network connections. The DLL file also utilized the sleep function, which stopped the execution of the malware. They will continue executing other commands after receiving the correct command from the C2 server.

<br/><br/>

## Lab 01-02

### 1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

![virustotal scan for lab01-02](lab01_02.png)

<br/><br/>

### 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Using PeiD, We can see that upx is packing the executable.

![Executable is packed by upx](lab01_02_packed.png)

We can use back UPX to unpack the file.

![Unpacking the file using upx](lab01_02_unpack.png)

![unpacked file](lab01_02_unpacked.png)

<br/><br/>

### 3. Do any imports hint at this program's functionality? If so, which imports are they and what do they tell you?

The program seems to be importing functions from Kernel32.dll to create a mutex for the program, which are normally used by alot of malware. The program also seems to be using threading in the program. 

![Kernel32.dll functions import](lab01_02_imports_kernel32.png)

Next, the program also imports functions from ADVAPI32.dll. This library contains functions that support security and registry calls. The imported functions seem to be creating service(s) for the program. 

![ADVAPI.dll functions import](lab01_02_imports_advapi32.png)

Then, the program also imports functions from WININET.dll to use the HTTP protocol to access the internet resources.

![WININET.dll functions import](lab01_02_imports_wininet.png)

<br/><br/>

### 4. What host- or network-based indicators could be used to identify this malware on infected machines?

Using the strings utilities, some rather interesting strings are found.

![lab01-02 IOC](lab01_02_ioc.png)

We can see that there are some names that the program uses. "MalService", "malservice", "HGL34", might be the name used in Mutex or the service of the malware. There's also a URL that we could use as an IOC to detect malicious program activity in our network.

<br/><br/>

### Reverse engineering lab01-02 
Using Ghidra, I performed a simple analysis of the program. I found that "Malservice" is used as the service name of the program when executed.

![lab01-02 service name used](lab01_02_serviceName.png)

While a bit above the code, we can see that "HGL345" is used as the Mutex name for the program.

![lab01-02 mutex name used](lab01_02_mutexName.png)

<br/><br/>

## Lab 01-03

### 1. Upload the Lab01-03.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

Yup, matched.

![lab01-03 virustotal scan](lab01_03.png)

<br/><br/>

### 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Using PEiD again, it's rather apparent that the file is packed. The entry point and the file offset are different, and the compiler shown for the file is "FSG 1.0 -> dulek/xt". Not to mention, the program only imports two functions.

![lab01-03 is packed](lab01_03_packed.png)

![lab01-03 function import when packed](lab01_03_packed_imports.png)

Not sure what that is but after some research and some attempts to unpack the program manually, nothing was working, so I decided to leave it for now. I have tried to find the real entry point to the program, but I just cannot find its address. I will definitely unpack this in the future. 

<br/><br/>

### 3. Do any imports hint at this program's functionality? If so, which imports are they and what do they tell you?

From the looks of the imports, when the program is packed, it is hard to tell what functionality it will perform after execution. 

<br/><br/>

### 4. What host- or network-based indicators could be used to identify this  malware on infected machines?

Unfortunately, no IOC could be found if the program is packed.

<br/><br/>

## lab01-04

### 1. Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?

Yup, like the previous files, it is flagged by VirusTotal engine.

![lab01-04 virustotal scan](lab01_04.png)

<br/><br/>

### 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

Using PEiD the program doesn't seem to be packed.

![lab01-04 not packed](lab01_04_not_packed.png)

<br/><br/>

### 3. When was this program compiled?

Using PE-Bear, the program seems to be compiled on 30/8/19 

![lab01-04 compiled date](lab01_04_compiled_date.png)

<br/><br/>

### 4. Do any imports hint at this program's functionality? If so, which imports are they, and what do they tell you?

Two major imports are found in the binary; KERNEL32 and ADVAPI32 library. Although some functions are typically imported by applications, there is one function that got my interest. The "WinExec" function. From Mircosoft's documentation, the "WinExec" is used to run a specified application. That is probably why we have functions used to locate a file and load it into the program. The program will probably execute another program in the memory after being executed. The program will also provide the proper permissions to the new application execution with the help of the functions imported from the ADVAPI32 library. 

![lab01-04 importing KERNEL32.dll](lab01_04_imports_kernel32.png)

![lab01-04 importing ADVAPI32.dll](lab01_04_imports_ADVAPI32.png)

<br/><br/>

### 5. What host- or network-based indicators could be used to identify this malware on infected machines?

I found some IOCs that might be used as host and network-based indicators. 

![lab01-04 IOC](lab01_04_IOC.png)

As seen in the image above, we can see that two interesting filenames could be used to act as the host-based IOC for the malware. Then, the URL could be used as the network-based IOC to detect the malicious file in the network.

Host IOC
 - winup.exe
 - updater.exe

Network IOC
 - http[://]www[.]practicalmalwareanalysis[.]com/updater[.]exe

<br/><br/>

### 6. This file has one resource in the resource section. Use Resource Hacker to examine that resource and then use it to extract the resource. What can you learn from the resource?

After getting the results from using the strings command just now, it is weird that there are no imports in the binary where a URL could be used when the program is executed. After using the Resource Hacker to extract the resource found in the program, we can clearly see that the program run from executing the lab01-04.exe program will utilize a function to download a file from a URL. 

![lab01-04 Resource Hacker](lab01_04_resource_hacker.png)

<br/><br/>

### Reverse engineering lab01-04

After Reverse engineering the program, we can see that the program is searching for a directory of a binary file. The wupdmgr.exe program is used to manage the windows update. The program most probably wants to check if the windows update is enabled. The malicious program uses "winup.exe" as the program name. The binary file will be moved to the temp folder of the machine. 

![lab01-04 IOC afte RE](lab01_04_IOC_RE.png)

Beside of getting some information on some binary file. I also found something weird with the program. When the program is executed using the debugger, the code execution will loop through this location many times before exiting the program after passing through a check several times.

![lab01-04 weird loop](lab01_04_weird_loop.png)

What I understand is that since my machine doesn't have mupdmgr.exe installed into the System32 folder, the program wasn't able to continue with the rest of the program execution. 