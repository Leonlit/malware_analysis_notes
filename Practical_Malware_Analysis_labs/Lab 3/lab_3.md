# Lab 3

## Lab 03-01

### 1. What are this malware’s imports and strings?

The binary seems to be packed as viewed in PE-bear. Then using PEiD it seems that the binary is packed with a tool called PEncrypt. When viewed with PE-Bear, there seems to be one import only. But after executing the binary, more imports can be viewed using the process hacker.

![lab03-01 strings](lab03_01_exe_strings.png)

![lab03-01 imports](lab03_01_exe_imports.png)

![lab03-01 packed](lab03_01_exe_packed.png)

![lab03-01 unpacked imports](lab03_01_exe_unpacked_imports.png)

### 2. What are the malware’s host-based indicators?

There is three host based IOC that could be used to detect the malware activity. The malware would create a mutex named WinVMX32. It would also add a value into the HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run registry with the key named VideoDriver.  

![lab03-01 mutex](lab03_01_exe_mutex.png)

![lab03-01 persistence IOC](lab03_01_exe_persistence_host_ioc.png)

![lab03-01 Video Driver key added](lab03_01_exe_video_driver_host_ioc.png)

![lab03-01 RegShot image of added key value](lab03_01_exe_regShot.png)

### 3. Are there any useful network-based signatures for this malware? If so, what are they?

The malware seems to be requesting DNS request from www.practicalmalwareanalysis.com from the DNS server and trying to request pages from the URL.

![lab03-01 network IOC](lab03_01_exe_network.png)

## Lab 03-02

### 1. How can you get this malware to install itself?

![lab03-02 Functions export](lab03_02_dll_exports.png)

Viewing the exports of the dll file, we can see that there's a function called installA. We could install the malware using that function. The function will create a new service called IPRIP (based on the notification shown by window xp). 

### 2. How would you get this malware to run after installation?

To run the installed malware, we need to execute the command net start IPRIP to start the service

![lab03-02 Starting the service from the cmd](lab03_02_dll_starting_services.png)


### 3. How can you find the process under which this malware is running?

To identify where is the malware running at (the process that it is running in), we can use process hacker and identify the PID of the service. Using that PID, we can identify the process that's running the malware. In this case, the malware is executing under one of the svchost.exe process. 

![lab03-02 Finding the PID of the malware using Process hacker](lab03_02_dll_finding_pid_in_process_hacker.png)

![lab03-02 Finding the process the malwware is running on using process hacker](lab03_02_dll_finding_service_parent.png)

When clicking into the process, we can see that lab03-02.dll is loaded as one of the module used by the process. 

![lab03-02 The malware is loaded in the svchost.exe modules](lab03_02_dll_finding_loaded_dll.png)


### 4. Which filters could you set in order to use procmon to glean information?

We can get all the information of the malware using the PID the malware module is running in.

### 5. What are the malware’s host-based indicators?

![lab03-02 registers keys added](lab03_02_dll_reg_keys_added.png)

![lab03-02 registers values added](lab03_02_dll_reg_values_added.png)

This malware has a display name of "Intranet Network Awareness (INA+)", service name "IPRIP", and the description of the module. The malware will also add a new key entry at "HKLM\SYSTEM\CurrentControlSet\Services\IPRIP\Parameters\ServiceDll: {The path to the dll}". These can be used as Host-based indicator. 

### 6. Are there any useful network-based signatures for this malware?

For network-based signature, the malware seems to be requesting HTTP requests to a domain name "http://practicalmalwareanalysis.com". It seems to be requesting a page named service.html, which returned HTTP response code 404 which means the server can't find the page.

![lab03-02 wireshark network IOC](lab03_02_dll_http_requests.png)
